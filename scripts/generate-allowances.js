const XLSX = require('xlsx');
const countryList = require('country-list');
const iso3166 = require('iso-3166-1-alpha-2');

// 원본 데이터
const rawData = [
  { name: 'Afghanistan', full: 30.00, partial: 20.00, accommodation: 95.00 },
  { name: 'Ägypten', full: 50.00, partial: 33.00, accommodation: 112.00 },
  { name: 'Äthiopien', full: 39.00, partial: 26.00, accommodation: 130.00 },
  { name: 'Äquatorialguinea', full: 47.00, partial: 32.00, accommodation: 166.00 },
  { name: 'Albanien', full: 27.00, partial: 18.00, accommodation: 112.00 },
  { name: 'Algerien', full: 47.00, partial: 32.00, accommodation: 120.00 },
  { name: 'Andorra', full: 41.00, partial: 28.00, accommodation: 91.00 },
  { name: 'Angola', full: 52.00, partial: 35.00, accommodation: 265.00 },
  { name: 'Argentinien', full: 35.00, partial: 24.00, accommodation: 113.00 },
  { name: 'Armenien', full: 24.00, partial: 16.00, accommodation: 90.00 },
  { name: 'Aserbaidschan', full: 44.00, partial: 29.00, accommodation: 86.00 },
  { name: 'Australien-Canberra', full: 51.00, partial: 34.00, accommodation: 158.00 },
  { name: 'Australien-Sydney', full: 68.00, partial: 45.00, accommodation: 184.00 },
  { name: 'Australien', full: 51.00, partial: 34.00, accommodation: 158.00 },
  { name: 'Bahrain', full: 48.00, partial: 32.00, accommodation: 153.00 },
  { name: 'Bangladesch', full: 50.00, partial: 33.00, accommodation: 165.00 },
  { name: 'Barbados', full: 52.00, partial: 35.00, accommodation: 165.00 },
  { name: 'Belgien', full: 42.00, partial: 28.00, accommodation: 135.00 },
  { name: 'Benin', full: 52.00, partial: 35.00, accommodation: 115.00 },
  { name: 'Bolivien', full: 46.00, partial: 31.00, accommodation: 108.00 },
  { name: 'Bosnien und Herzegowina', full: 23.00, partial: 16.00, accommodation: 75.00 },
  { name: 'Botsuana', full: 46.00, partial: 31.00, accommodation: 176.00 },
  { name: 'Brasilien-Rio de Janeiro', full: 57.00, partial: 38.00, accommodation: 145.00 },
  { name: 'Brasilien-Sao Paulo', full: 57.00, partial: 38.00, accommodation: 127.00 },
  { name: 'Brasilien', full: 51.00, partial: 34.00, accommodation: 84.00 },
  { name: 'Brunei', full: 52.00, partial: 35.00, accommodation: 106.00 },
  { name: 'Bulgarien', full: 22.00, partial: 15.00, accommodation: 115.00 },
  { name: 'Burkina Faso', full: 38.00, partial: 25.00, accommodation: 174.00 },
  { name: 'Burundi', full: 47.00, partial: 32.00, accommodation: 138.00 },
  { name: 'Chile', full: 44.00, partial: 29.00, accommodation: 154.00 },
  { name: 'China-Chengdu', full: 41.00, partial: 28.00, accommodation: 131.00 },
  { name: 'China-Hongkong', full: 74.00, partial: 49.00, accommodation: 145.00 },
  { name: 'China-Kanton', full: 36.00, partial: 24.00, accommodation: 150.00 },
  { name: 'China-Peking', full: 30.00, partial: 20.00, accommodation: 185.00 },
  { name: 'China-Shanghai', full: 54.00, partial: 36.00, accommodation: 217.00 },
  { name: 'China', full: 48.00, partial: 32.00, accommodation: 112.00 },
  { name: 'Costa Rica', full: 47.00, partial: 32.00, accommodation: 93.00 },
  { name: 'Côte d\'Ivoire', full: 59.00, partial: 40.00, accommodation: 166.00 },
  { name: 'Dänemark', full: 75.00, partial: 50.00, accommodation: 183.00 },
  { name: 'Deutschland', full: 28.00, partial: 14.00, accommodation: 0.00 },
  { name: 'Dominica', full: 45.00, partial: 30.00, accommodation: 177.00 },
  { name: 'Dominikanische Republik', full: 45.00, partial: 30.00, accommodation: 147.00 },
  { name: 'Dschibuti', full: 65.00, partial: 44.00, accommodation: 305.00 },
  { name: 'Ecuador', full: 27.00, partial: 18.00, accommodation: 103.00 },
  { name: 'El Salvador', full: 65.00, partial: 44.00, accommodation: 161.00 },
  { name: 'Eritrea', full: 46.00, partial: 31.00, accommodation: 91.00 },
  { name: 'Estland', full: 29.00, partial: 20.00, accommodation: 85.00 },
  { name: 'Fidschi', full: 34.00, partial: 23.00, accommodation: 69.00 },
  { name: 'Finnland', full: 50.00, partial: 33.00, accommodation: 136.00 },
  { name: 'Frankreich', full: 53.00, partial: 36.00, accommodation: 115.00 },
  { name: 'Frankreich-Lyon', full: 53.00, partial: 36.00, accommodation: 115.00 },
  { name: 'Frankreich-Marseille', full: 46.00, partial: 31.00, accommodation: 101.00 },
  { name: 'Frankreich-Paris', full: 58.00, partial: 39.00, accommodation: 159.00 },
  { name: 'Frankreich', full: 53.00, partial: 36.00, accommodation: 105.00 },
  { name: 'Gabun', full: 52.00, partial: 35.00, accommodation: 183.00 },
  { name: 'Gambia', full: 40.00, partial: 27.00, accommodation: 161.00 },
  { name: 'Georgien', full: 32.00, partial: 21.00, accommodation: 88.00 },
  { name: 'Ghana', full: 46.00, partial: 31.00, accommodation: 148.00 },
  { name: 'Grenada', full: 45.00, partial: 30.00, accommodation: 177.00 },
  { name: 'Griechenland-Athen', full: 40.00, partial: 27.00, accommodation: 135.00 },
  { name: 'Griechenland', full: 36.00, partial: 24.00, accommodation: 150.00 },
  { name: 'Guatemala', full: 48.00, partial: 32.00, accommodation: 90.00 },
  { name: 'Guinea', full: 46.00, partial: 31.00, accommodation: 118.00 },
  { name: 'Guinea-Bissau', full: 32.00, partial: 21.00, accommodation: 113.00 },
  { name: 'Haiti', full: 57.00, partial: 38.00, accommodation: 198.00 },
  { name: 'Honduras', full: 48.00, partial: 32.00, accommodation: 101.00 },
  { name: 'Indien-Bangalore', full: 42.00, partial: 28.00, accommodation: 155.00 },
  { name: 'Indien-Chennai', full: 32.00, partial: 21.00, accommodation: 85.00 },
  { name: 'Indien-Kalkutta', full: 35.00, partial: 24.00, accommodation: 145.00 },
  { name: 'Indien-Mumbai', full: 50.00, partial: 33.00, accommodation: 146.00 },
  { name: 'Indien-Neu Delhi', full: 38.00, partial: 25.00, accommodation: 185.00 },
  { name: 'Indien', full: 32.00, partial: 21.00, accommodation: 85.00 },
  { name: 'Indonesien', full: 36.00, partial: 24.00, accommodation: 134.00 },
  { name: 'Irak', full: 54.00, partial: 36.00, accommodation: 129.00 },
  { name: 'Iran', full: 62.00, partial: 41.00, accommodation: 187.00 },
  { name: 'Israel', full: 66.00, partial: 44.00, accommodation: 190.00 },
  { name: 'Italien-Madrid', full: 45.00, partial: 30.00, accommodation: 158.00 },
  { name: 'Italien-Rom', full: 40.00, partial: 27.00, accommodation: 135.00 },
  { name: 'Italien', full: 40.00, partial: 27.00, accommodation: 135.00 },
  { name: 'Jamaika', full: 57.00, partial: 38.00, accommodation: 138.00 },
  { name: 'Japan-Tokio', full: 66.00, partial: 44.00, accommodation: 233.00 },
  { name: 'Japan', full: 52.00, partial: 35.00, accommodation: 190.00 },
  { name: 'Jemen', full: 24.00, partial: 16.00, accommodation: 95.00 },
  { name: 'Jordanien', full: 46.00, partial: 31.00, accommodation: 134.00 },
  { name: 'Kambodscha', full: 38.00, partial: 25.00, accommodation: 94.00 },
  { name: 'Kamerun', full: 50.00, partial: 33.00, accommodation: 180.00 },
  { name: 'Kanada-Ottawa', full: 47.00, partial: 32.00, accommodation: 142.00 },
  { name: 'Kanada-Toronto', full: 51.00, partial: 34.00, accommodation: 161.00 },
  { name: 'Kanada-Vancouver', full: 47.00, partial: 32.00, accommodation: 140.00 },
  { name: 'Kanada', full: 47.00, partial: 32.00, accommodation: 154.00 },
  { name: 'Kap Verde', full: 30.00, partial: 20.00, accommodation: 105.00 },
  { name: 'Kasachstan', full: 45.00, partial: 30.00, accommodation: 111.00 },
  { name: 'Katar', full: 56.00, partial: 37.00, accommodation: 170.00 },
  { name: 'Kenia', full: 51.00, partial: 34.00, accommodation: 219.00 },
  { name: 'Kirgisistan', full: 29.00, partial: 20.00, accommodation: 91.00 },
  { name: 'Kolumbien', full: 46.00, partial: 31.00, accommodation: 155.00 },
  { name: 'Kongo', full: 62.00, partial: 41.00, accommodation: 215.00 },
  { name: 'Kongo, Republik', full: 50.00, partial: 33.00, accommodation: 200.00 }
];

// 국가 코드 매핑
const countryCodeMapping = {
  'Afghanistan': 'AF',
  'Ägypten': 'EG',
  'Äthiopien': 'ET',
  'Äquatorialguinea': 'GQ',
  'Albanien': 'AL',
  'Algerien': 'DZ',
  'Andorra': 'AD',
  'Angola': 'AO',
  'Argentinien': 'AR',
  'Armenien': 'AM',
  'Aserbaidschan': 'AZ',
  'Australien': 'AU',
  'Australien-Canberra': 'AU-CBR',
  'Australien-Sydney': 'AU-SYD',
  'Bahrain': 'BH',
  'Bangladesch': 'BD',
  'Barbados': 'BB',
  'Belgien': 'BE',
  'Benin': 'BJ',
  'Bolivien': 'BO',
  'Bosnien und Herzegowina': 'BA',
  'Botsuana': 'BW',
  'Brasilien': 'BR',
  'Brasilien-Rio de Janeiro': 'BR-RIO',
  'Brasilien-Sao Paulo': 'BR-SAO',
  'Brunei': 'BN',
  'Bulgarien': 'BG',
  'Burkina Faso': 'BF',
  'Burundi': 'BI',
  'Chile': 'CL',
  'China': 'CN',
  'China-Chengdu': 'CN-CTU',
  'China-Hongkong': 'CN-HKG',
  'China-Kanton': 'CN-CAN',
  'China-Peking': 'CN-BJS',
  'China-Shanghai': 'CN-SHA',
  'Costa Rica': 'CR',
  'Côte d\'Ivoire': 'CI',
  'Dänemark': 'DK',
  'Deutschland': 'DE',
  'Dominica': 'DM',
  'Dominikanische Republik': 'DO',
  'Dschibuti': 'DJ',
  'Ecuador': 'EC',
  'El Salvador': 'SV',
  'Eritrea': 'ER',
  'Estland': 'EE',
  'Fidschi': 'FJ',
  'Finnland': 'FI',
  'Frankreich': 'FR',
  'Frankreich-Lyon': 'FR-LYS',
  'Frankreich-Marseille': 'FR-MRS',
  'Frankreich-Paris': 'FR-PAR',
  'Gabun': 'GA',
  'Gambia': 'GM',
  'Georgien': 'GE',
  'Ghana': 'GH',
  'Grenada': 'GD',
  'Griechenland': 'GR',
  'Griechenland-Athen': 'GR-ATH',
  'Guatemala': 'GT',
  'Guinea': 'GN',
  'Guinea-Bissau': 'GW',
  'Haiti': 'HT',
  'Honduras': 'HN',
  'Indien': 'IN',
  'Indien-Bangalore': 'IN-BLR',
  'Indien-Chennai': 'IN-MAA',
  'Indien-Kalkutta': 'IN-CCU',
  'Indien-Mumbai': 'IN-BOM',
  'Indien-Neu Delhi': 'IN-DEL',
  'Indonesien': 'ID',
  'Irak': 'IQ',
  'Iran': 'IR',
  'Israel': 'IL',
  'Italien': 'IT',
  'Italien-Madrid': 'IT-MAD',
  'Italien-Rom': 'IT-ROM',
  'Jamaika': 'JM',
  'Japan': 'JP',
  'Japan-Tokio': 'JP-TYO',
  'Jemen': 'YE',
  'Jordanien': 'JO',
  'Kambodscha': 'KH',
  'Kamerun': 'CM',
  'Kanada': 'CA',
  'Kanada-Ottawa': 'CA-OTT',
  'Kanada-Toronto': 'CA-TOR',
  'Kanada-Vancouver': 'CA-VAN',
  'Kap Verde': 'CV',
  'Kasachstan': 'KZ',
  'Katar': 'QA',
  'Kenia': 'KE',
  'Kirgisistan': 'KG',
  'Kolumbien': 'CO',
  'Kongo': 'CG',
  'Kongo, Republik': 'CD'
};

// 한국어 국가명 매핑 추가
const koreanNameMapping = {
  'Afghanistan': '아프가니스탄',
  'Ägypten': '이집트',
  'Äthiopien': '에티오피아',
  'Äquatorialguinea': '적도 기니',
  'Albanien': '알바니아',
  'Algerien': '알제리',
  'Andorra': '안도라',
  'Angola': '앙골라',
  'Argentinien': '아르헨티나',
  'Armenien': '아르메니아',
  'Aserbaidschan': '아제르바이잔',
  'Australien': '호주',
  'Australien-Canberra': '호주 (캔버라)',
  'Australien-Sydney': '호주 (시드니)',
  'Bahrain': '바레인',
  'Bangladesch': '방글라데시',
  'Barbados': '바베이도스',
  'Belgien': '벨기에',
  'Benin': '베냉',
  'Bolivien': '볼리비아',
  'Bosnien und Herzegowina': '보스니아 헤르체고비나',
  'Botsuana': '보츠와나',
  'Brasilien': '브라질',
  'Brasilien-Rio de Janeiro': '브라질 (리우데자네이루)',
  'Brasilien-Sao Paulo': '브라질 (상파울루)',
  'Brunei': '브루나이',
  'Bulgarien': '불가리아',
  'Burkina Faso': '부르키나파소',
  'Burundi': '부룬디',
  'Chile': '칠레',
  'China': '중국',
  'China-Chengdu': '중국 (청두)',
  'China-Hongkong': '중국 (홍콩)',
  'China-Kanton': '중국 (광저우)',
  'China-Peking': '중국 (베이징)',
  'China-Shanghai': '중국 (상하이)',
  'Costa Rica': '코스타리카',
  'Côte d\'Ivoire': '코트디부아르',
  'Dänemark': '덴마크',
  'Deutschland': '독일',
  'Dominica': '도미니카',
  'Dominikanische Republik': '도미니카 공화국',
  'Dschibuti': '지부티',
  'Ecuador': '에콰도르',
  'El Salvador': '엘살바도르',
  'Eritrea': '에리트레아',
  'Estland': '에스토니아',
  'Fidschi': '피지',
  'Finnland': '핀란드',
  'Frankreich': '프랑스',
  'Frankreich-Lyon': '프랑스 (리옹)',
  'Frankreich-Marseille': '프랑스 (마르세유)',
  'Frankreich-Paris': '프랑스 (파리)',
  'Gabun': '가봉',
  'Gambia': '감비아',
  'Georgien': '조지아',
  'Ghana': '가나',
  'Grenada': '그레나다',
  'Griechenland': '그리스',
  'Griechenland-Athen': '그리스 (아테네)',
  'Guatemala': '과테말라',
  'Guinea': '기니',
  'Guinea-Bissau': '기니비사우',
  'Haiti': '아이티',
  'Honduras': '온두라스',
  'Indien': '인도',
  'Indien-Bangalore': '인도 (방갈로르)',
  'Indien-Chennai': '인도 (첸나이)',
  'Indien-Kalkutta': '인도 (콜카타)',
  'Indien-Mumbai': '인도 (뭄바이)',
  'Indien-Neu Delhi': '인도 (뉴델리)',
  'Indonesien': '인도네시아',
  'Irak': '이라크',
  'Iran': '이란',
  'Israel': '이스라엘',
  'Italien': '이탈리아',
  'Italien-Madrid': '이탈리아 (마드리드)',
  'Italien-Rom': '이탈리아 (로마)',
  'Jamaika': '자메이카',
  'Japan': '일본',
  'Japan-Tokio': '일본 (도쿄)',
  'Jemen': '예멘',
  'Jordanien': '요르단',
  'Kambodscha': '캄보디아',
  'Kamerun': '카메룬',
  'Kanada': '캐나다',
  'Kanada-Ottawa': '캐나다 (오타와)',
  'Kanada-Toronto': '캐나다 (토론토)',
  'Kanada-Vancouver': '캐나다 (밴쿠버)',
  'Kap Verde': '카보베르데',
  'Kasachstan': '카자흐스탄',
  'Katar': '카타르',
  'Kenia': '케냐',
  'Kirgisistan': '키르기스스탄',
  'Kolumbien': '콜롬비아',
  'Kongo': '콩고',
  'Kongo, Republik': '콩고 공화국'
};

// 독일어 -> 영어 국가명 매핑
const germanToEnglish = {
  'Ägypten': 'Egypt',
  'Albanien': 'Albania',
  'Algerien': 'Algeria',
  'Armenien': 'Armenia',
  'Aserbaidschan': 'Azerbaijan',
  'Äthiopien': 'Ethiopia',
  'Australien': 'Australia',
  // ... (나머지 매핑 추가)
};

// 도시-국가 결합 처리 함수
function processCityCountry(name) {
  if (name.includes('-')) {
    const [city, country] = name.split('-');
    return `${country} (${city})`;
  }
  return name;
}

// 국가 코드 찾기 함수
function findCountryCode(germanName) {
  // 도시가 포함된 경우 국가 이름만 추출
  const baseName = germanName.includes('-') ? germanName.split('-')[1] : germanName;
  
  // 독일어 국가명을 영어로 변환
  const englishName = germanToEnglish[baseName] || baseName;
  
  return countryList.getCode(englishName) || 'XX';
}

// 데이터 변환
const transformedData = rawData.map(item => ({
  country_code: countryCodeMapping[item.name],
  country_name_de: item.name,
  country_name_ko: koreanNameMapping[item.name] || item.name,
  full_day_amount: Number(item.full.toFixed(2)),
  partial_day_amount: Number(item.partial.toFixed(2)),
  accommodation_amount: Number(item.accommodation.toFixed(2))
}));

// 엑셀 파일 생성
const worksheet = XLSX.utils.json_to_sheet(transformedData);

// 열 너비 설정
const wscols = [
  {wch: 15},  // country_code
  {wch: 30},  // country_name_de
  {wch: 30},  // country_name_ko
  {wch: 15},  // full_day_amount
  {wch: 15},  // partial_day_amount
  {wch: 15}   // accommodation_amount
];
worksheet['!cols'] = wscols;

const workbook = XLSX.utils.book_new();
XLSX.utils.book_append_sheet(workbook, worksheet, "Country Allowances");

// 파일 저장
XLSX.writeFile(workbook, "country-allowances.xlsx");

console.log('엑셀 파일이 생성되었습니다: country-allowances.xlsx'); 